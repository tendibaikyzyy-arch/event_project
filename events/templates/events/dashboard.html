{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç ‚Äî KINI √ó Yessenov</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  /* ===== –ì–ª–æ–±–∞–ª + —Ñ–æ–Ω (–Ω–µ–∂–Ω—ã–π –ø–∞—Å—Ç–µ–ª—å–Ω—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç) ===== */
  :root{
    --bg1:#fff7f0; --bg2:#eaf7ff; --bg3:#f5e9ff;
    --brand:#ff7f50; --brand-dark:#ff5722;
    --text:#222; --muted:#666; --card:#ffffff;
    --shadow:0 8px 24px rgba(0,0,0,.12);
    --line:#f0f0f0;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
    background: linear-gradient(135deg,var(--bg1),var(--bg2),var(--bg3));
    background-size: 200% 200%;
    animation: bgMove 20s ease infinite;
  }
  @keyframes bgMove {
    0%{background-position:0% 50%}
    50%{background-position:100% 50%}
    100%{background-position:0% 50%}
  }

  /* ===== –ú–∞–∫–µ—Ç: —à–∞–ø–∫–∞ + –∫–æ–ª–æ–Ω–∫–∞–ª–∞—Ä ===== */
  header{
    display:flex; align-items:center; justify-content:space-between;
    padding:14px 20px; backdrop-filter:saturate(120%) blur(6px);
  }
  .logo{height:44px}
  .brand-title{margin:0 14px; font-weight:800; letter-spacing:.5px; color:#333}

  .wrap{display:grid; grid-template-columns: 260px 1fr; gap:18px; padding:0 18px 24px;}
  @media (max-width: 980px){ .wrap{grid-template-columns:1fr} }

  /* ===== –°–∞–π–¥–±–∞—Ä ===== */
  .sidebar{
    background:var(--card); border:1px solid var(--line); border-radius:14px; box-shadow:var(--shadow);
    padding:14px; position:sticky; top:14px; height:fit-content;
  }
  .userbox{padding:12px 12px 2px 12px}
  .username{font-weight:800}
  .menu{margin:10px 0 0; padding:0; list-style:none}
  .menu li{margin:6px 0}
  .menu a{
    display:flex; align-items:center; gap:10px;
    padding:10px 12px; border-radius:10px; color:var(--text); text-decoration:none;
    border:1px solid transparent;
  }
  .menu a.active, .menu a:hover{background:#fff6f1; border-color:#ffe1d5}
  .muted{color:var(--muted); font-size:13px; margin:10px 12px}

  /* ===== –ö–æ–Ω—Ç–µ–Ω—Ç –∫–∞—Ä—Ç–æ—á–∫–∞ ===== */
  .content{
    background:var(--card); border:1px solid var(--line); border-radius:14px; box-shadow:var(--shadow);
    padding:18px;
  }
  .topbar{
    display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;
    margin-bottom:14px;
  }
  .btn{
    appearance:none; border:none; cursor:pointer; font-weight:700;
    padding:10px 14px; border-radius:10px; color:#fff; background:var(--brand);
    box-shadow:0 4px 14px rgba(255,127,80,.35);
  }
  .btn:hover{background:var(--brand-dark)}
  .btn.sec{background:#eef3ff; color:#2f3bff; box-shadow:none}
  .btn.sec:hover{background:#e3e9ff}

  /* ===== –î–≤–µ –∫–æ–ª–æ–Ω–∫–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ–π ===== */
  .calgrid{
    display:grid; grid-template-columns: 320px 1fr; gap:16px;
  }
  @media (max-width:1100px){ .calgrid{grid-template-columns:1fr} }

  .card{
    background:#fff; border:1px solid var(--line); border-radius:12px; padding:12px; box-shadow:var(--shadow);
  }
  .card h3{margin:6px 8px 12px; font-size:16px}

  /* ===== –ú–∏–Ω–∏-–∫–∞–ª–µ–Ω–¥–∞—Ä—å ===== */
  .mini-cal .head{
    display:flex; justify-content:space-between; align-items:center; padding:6px 8px;
  }
  .mini-cal .grid{
    display:grid; grid-template-columns: repeat(7, 1fr); gap:6px; padding:8px;
  }
  .mini-cal .dow, .mini-cal .cell{
    text-align:center; padding:8px 0; border-radius:8px; font-size:13px;
  }
  .mini-cal .dow{color:var(--muted); font-weight:700}
  .mini-cal .cell{background:#fafafa; border:1px solid #eee}
  .mini-cal .cell.today{outline:2px solid #ffd1bf}
  .mini-cal .cell.has{background:#fff3ec; border-color:#ffd9c8; font-weight:700}

  /* ===== “Æ–ª–∫–µ–Ω –∫–∞–ª–µ–Ω–¥–∞—Ä—å ===== */
  .big-cal .grid{
    display:grid; grid-template-columns: repeat(7, 1fr); gap:10px; padding:10px;
  }
  .bcell{
    background:#fafafa; border:1px dashed #e9e9e9; border-radius:10px; min-height:110px; padding:8px; position:relative;
  }
  .bcell .dnum{position:absolute; top:6px; right:8px; font-size:12px; color:var(--muted)}
  .event{display:block; margin:4px 0 0; padding:6px 8px; border-radius:8px; font-size:13px;
    background:#fff; border:1px solid #ffe1d5; box-shadow:0 2px 8px rgba(0,0,0,.05);
  }
  .event strong{display:block; color:#333}
  .event small{color:#888}

  /* ===== –†–∞–∑–¥–µ–ª—ã (–º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è, –º–æ–∏, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è) ===== */
  .section{display:none}
  .section.active{display:block}
  .cards{
    display:grid; grid-template-columns: repeat(auto-fit,minmax(220px,1fr)); gap:14px;
  }
  .ecard{
    background:#fff; border:1px solid var(--line); border-radius:12px; padding:12px; box-shadow:var(--shadow);
  }
  .ecard h4{margin:4px 0 8px}
  .muted2{color:#777; font-size:13px}
</style>
</head>
<body>

  <!-- ===== –®–∞–ø–∫–∞: –ª–æ–≥–æ—Ç–∏–ø—Ç–µ—Ä –±”©–ª–µ–∫ ===== -->
  <header>
    <div style="display:flex; align-items:center; gap:10px">
      <img class="logo" src="{% static 'img/yessenov.png' %}" alt="Yessenov">
      <h1 class="brand-title">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h1>
    </div>
    <img class="logo" src="{% static 'img/kini.png' %}" alt="KINI">
  </header>

  <div class="wrap">
    <!-- ===== –°–∞–π–¥–±–∞—Ä ===== -->
    <aside class="sidebar">
      <div class="userbox">
        <div class="username">üëã {{ request.user.username }}</div>
        <div class="muted">–†–æ–ª—å: {% if request.user.is_superuser %}–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä{% else %}–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å{% endif %}</div>
      </div>

      <ul class="menu">
        <li><a href="#" data-view="cal" class="active">üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å</a></li>
        <li><a href="#" data-view="list">üìå –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</a></li>
        <li><a href="#" data-view="mine">‚≠ê –ú–æ–∏ —Å–æ–±—ã—Ç–∏—è</a></li>
        <li><a href="#" data-view="notif">üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</a></li>
      </ul>

      <div class="muted">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</div>
      <div style="display:flex; gap:8px; padding:0 12px 8px 12px">
        <button class="btn" id="bookBtn">+ –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
        {% if request.user.is_superuser %}
          <a href="/create-event/" class="btn sec">–°–æ–∑–¥–∞—Ç—å</a>
        {% endif %}
      </div>
      <div class="muted" style="padding:0 12px"> <a href="/logout/">–í—ã–π—Ç–∏</a> </div>
    </aside>

    <!-- ===== –ö–æ–Ω—Ç–µ–Ω—Ç ===== -->
    <main class="content">
      <!-- –†–∞–∑–¥–µ–ª 1: –î–≤–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä—è -->
      <section id="view-cal" class="section active">
        <div class="topbar">
          <h2 style="margin:0">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</h2>
          <div>
            <button class="btn sec" id="prevMonth">‚Üê</button>
            <button class="btn sec" id="today">–°–µ–≥–æ–¥–Ω—è</button>
            <button class="btn sec" id="nextMonth">‚Üí</button>
          </div>
        </div>

        <div class="calgrid">
          <!-- –ú–∏–Ω–∏-–∫–∞–ª–µ–Ω–¥–∞—Ä—å -->
          <div class="card mini-cal">
            <div class="head">
              <strong id="miniLabel">–ú–µ—Å—è—Ü</strong>
            </div>
            <div class="grid" id="miniDow"></div>
            <div class="grid" id="miniDays"></div>
          </div>

          <!-- “Æ–ª–∫–µ–Ω –∫–∞–ª–µ–Ω–¥–∞—Ä—å -->
          <div class="card big-cal">
            <h3 id="bigLabel">–ú–µ—Å—è—Ü</h3>
            <div class="grid" id="bigGrid"></div>
          </div>
        </div>
      </section>

      <!-- –†–∞–∑–¥–µ–ª 2: –°–ø–∏—Å–æ–∫ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π -->
      <section id="view-list" class="section">
        <div class="topbar"><h2 style="margin:0">–í—Å–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</h2></div>
        <div class="cards" id="eventsList"></div>
      </section>

      <!-- –†–∞–∑–¥–µ–ª 3: –ú–æ–∏ —Å–æ–±—ã—Ç–∏—è -->
      <section id="view-mine" class="section">
        <div class="topbar"><h2 style="margin:0">–ú–æ–∏ —Å–æ–±—ã—Ç–∏—è</h2></div>
        <div id="myEvents" class="cards"></div>
      </section>

      <!-- –†–∞–∑–¥–µ–ª 4: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
      <section id="view-notif" class="section">
        <div class="topbar"><h2 style="margin:0">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h2></div>
        <div class="ecard">
          <p class="muted2">–ü–æ–∫–∞ –Ω–µ—Ç –Ω–æ–≤—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π. –ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è üíå</p>
        </div>
      </section>
    </main>
  </div>

<script>
/* ================== –î–ê–ù–ù–´–ï: 10 –∏–≤–µ–Ω—Ç–æ–≤ ================== */
const EVENTS = [
  {id:1,  title:"–û—Å–µ–Ω–Ω–∏–π –±–∞–ª",          date:"2025-10-16", time:"18:00", place:"–ê–∫—Ç–æ–≤—ã–π –∑–∞–ª"},
  {id:2,  title:"–•—ç–ª–ª–æ—É–∏–Ω",             date:"2025-10-31", time:"19:00", place:"–°—Ç—É–¥–∫–ª—É–±"},
  {id:3,  title:"–í—Å—Ç—Ä–µ—á–∞ —Å –¥–µ–∫–∞–Ω–æ–º",    date:"2025-10-20", time:"15:00", place:"–ö–æ–Ω—Ñ. –∑–∞–ª"},
  {id:4,  title:"–ö–∏–Ω–æ–∑–∞–ª",              date:"2025-10-22", time:"20:00", place:"–ö–∏–Ω–æ–∑–∞–ª"},
  {id:5,  title:"–Ø—Ä–º–∞—Ä–∫–∞ –≤–∞–∫–∞–Ω—Å–∏–π",     date:"2025-11-01", time:"11:00", place:"–ì–ª–∞–≤–Ω—ã–π –∫–æ—Ä–ø—É—Å"},
  {id:6,  title:"IT –•–∞–∫–∞—Ç–æ–Ω",           date:"2025-11-25", time:"09:00", place:"Coworking Hub"},
  {id:7,  title:"–°–ø–æ—Ä—Ç–∏–≤–Ω—ã–π —Ç—É—Ä–Ω–∏—Ä",    date:"2025-11-10", time:"17:00", place:"–°–ø–æ—Ä—Ç–∑–∞–ª"},
  {id:8,  title:"–≠–∫–æ-–≤–æ–ª–æ–Ω—Ç—ë—Ä—ã",        date:"2025-11-12", time:"10:00", place:"–î–≤–æ—Ä –∫–∞–º–ø—É—Å–∞"},
  {id:9,  title:"–ö–ª—É–± –¥–µ–±–∞—Ç–æ–≤",         date:"2025-11-18", time:"16:00", place:"–ê—É–¥. 203"},
  {id:10, title:"–ö—É—Ä—Å—ã Python",         date:"2025-11-20", time:"18:30", place:"–õ–∞–±. 1"},
];

/* ================== –ù–∞–≤–∏–≥–∞—Ü–∏—è (–≤–Ω—É—Ç—Ä–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã) ================== */
document.querySelectorAll('.menu a').forEach(a=>{
  a.addEventListener('click', e=>{
    e.preventDefault();
    document.querySelectorAll('.menu a').forEach(x=>x.classList.remove('active'));
    a.classList.add('active');
    const v = a.dataset.view;
    document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
    document.getElementById('view-'+v).classList.add('active');
  });
});

/* ================== –ú–∏–Ω–∏-–∫–∞–ª–µ–Ω–¥–∞—Ä—å + –ë–æ–ª—å—à–æ–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å ================== */
const miniLabel = document.getElementById('miniLabel');
const miniDow   = document.getElementById('miniDow');
const miniDays  = document.getElementById('miniDays');
const bigLabel  = document.getElementById('bigLabel');
const bigGrid   = document.getElementById('bigGrid');

const DOW = ['–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±','–í—Å'];
let viewDate = new Date();

function ymd(d){ return d.toISOString().slice(0,10); }
function firstDayOfMonth(d){ return new Date(d.getFullYear(), d.getMonth(), 1); }
function daysInMonth(d){ return new Date(d.getFullYear(), d.getMonth()+1, 0).getDate(); }

function renderDOW(){
  miniDow.innerHTML = '';
  DOW.forEach(n=>{
    const el = document.createElement('div');
    el.className='dow'; el.textContent=n;
    miniDow.appendChild(el);
  });
}
renderDOW();

function renderCalendars(){
  const year = viewDate.getFullYear();
  const month = viewDate.getMonth();
  const monthName = viewDate.toLocaleString('ru', {month:'long'}).replace(/^./, c=>c.toUpperCase());
  miniLabel.textContent = ${monthName} ${year};
  bigLabel.textContent  = ${monthName} ${year};

  // –º–∏–Ω–∏
  miniDays.innerHTML = '';
  const fd = firstDayOfMonth(viewDate);
  let startIdx = fd.getDay(); // 0=–í—Å
  if (startIdx === 0) startIdx = 7; // –ü–µ—Ä–µ–Ω–æ—Å –í—Å –≤ –∫–æ–Ω–µ—Ü
  for(let i=1;i<startIdx;i++){
    const pad = document.createElement('div'); pad.className='cell'; pad.style.visibility='hidden';
    miniDays.appendChild(pad);
  }
  const dim = daysInMonth(viewDate);
  const todayStr = ymd(new Date());

  for(let d=1; d<=dim; d++){
    const el = document.createElement('div');
    el.className = 'cell';
    const thisDate = new Date(year, month, d);
    const ds = ymd(thisDate);
    if (ds === todayStr) el.classList.add('today');
    if (EVENTS.some(ev=>ev.date===ds)) el.classList.add('has');
    el.textContent = d;
    miniDays.appendChild(el);
  }

  // –±–æ–ª—å—à–æ–π
  bigGrid.innerHTML = '';
  // –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–Ω–µ–π
  DOW.forEach(n=>{
    const cap = document.createElement('div');
    cap.className='bcell'; cap.style.minHeight='32px'; cap.style.background='#fff'; cap.style.border='1px solid #eee';
    cap.innerHTML = <strong>${n}</strong>;
    bigGrid.appendChild(cap);
  });
  // –ø—É—Å—Ç—ã–µ –¥–æ –ø–µ—Ä–≤–æ–≥–æ –¥–Ω—è
  for(let i=1;i<startIdx;i++){
    const pad = document.createElement('div'); pad.className='bcell'; bigGrid.appendChild(pad);
  }
  // –¥–Ω–∏
  for(let d=1; d<=dim; d++){
    const cell = document.createElement('div'); cell.className='bcell';
    const thisDate = new Date(year, month, d);
    const ds = ymd(thisDate);
    cell.innerHTML = <span class="dnum">${d}</span>;
    // —Å–æ–±—ã—Ç–∏—è –≤ —ç—Ç–æ–º –¥–Ω–µ:
    EVENTS.filter(ev=>ev.date===ds).forEach(ev=>{
      const a = document.
      createElement('a');
      a.className = 'event';
      a.href = /events/${ev.id}/register/;
      a.innerHTML = <strong>${ev.title}</strong><small>${ev.time} ‚Ä¢ ${ev.place}</small>;
      cell.appendChild(a);
    });
    bigGrid.appendChild(cell);
  }
}
renderCalendars();

document.getElementById('prevMonth').onclick = ()=>{ viewDate.setMonth(viewDate.getMonth()-1); renderCalendars(); };
document.getElementById('nextMonth').onclick = ()=>{ viewDate.setMonth(viewDate.getMonth()+1); renderCalendars(); };
document.getElementById('today').onclick     = ()=>{ viewDate = new Date(); renderCalendars(); };

/* ================== –°–ø–∏—Å–æ–∫ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π (–∫–∞—Ä—Ç–æ—á–∫–∏) ================== */
function renderList(){
  const box = document.getElementById('eventsList');
  box.innerHTML = '';
  EVENTS.forEach(ev=>{
    const d = document.createElement('div');
    d.className='ecard';
    d.innerHTML = `
      <h4>${ev.title}</h4>
      <div class="muted2">${ev.date} ‚Ä¢ ${ev.time} ‚Ä¢ ${ev.place}</div>
      <button class="btn" onclick="location.href='/events/${ev.id}/register/'">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
    `;
    box.appendChild(d);
  });
}
renderList();

/* ================== –ú–æ–∏ —Å–æ–±—ã—Ç–∏—è (–¥–µ–º–æ) ================== */
function renderMine(){
  const box = document.getElementById('myEvents');
  box.innerHTML = `
    <div class="ecard"><p class="muted2">–ü–æ–∫–∞ –ø—É—Å—Ç–æ. –ù–∞–∂–º–∏—Ç–µ ‚Äú–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å‚Äù —É –ø–æ–Ω—Ä–∞–≤–∏–≤—à–µ–≥–æ—Å—è —Å–æ–±—ã—Ç–∏—è ‚Äî –∏ –æ–Ω–æ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å ‚ú®</p></div>
  `;
}
renderMine();

/* ================== –ë—ã—Å—Ç—Ä–∞—è –±—Ä–æ–Ω—å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî –±–ª–∏–∂–∞–π—à–µ–µ) ================== */
document.getElementById('bookBtn').onclick = ()=>{
  const soon = [...EVENTS].sort((a,b)=> a.date.localeCompare(b.date))[0];
  if (soon) location.href = /events/${soon.id}/register/;
  else alert('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π.');
};
</script>
</body>
</html>